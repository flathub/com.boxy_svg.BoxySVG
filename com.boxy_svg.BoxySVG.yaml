app-id: com.boxy_svg.BoxySVG
runtime: org.freedesktop.Platform
runtime-version: "21.08"
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: "21.08"
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node14
command: boxy-svg
tags: [proprietary]
separate-locales: false
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=xdg-data
  - --filesystem=xdg-desktop
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-templates
build-options:
  append-path: /usr/lib/sdk/node14/bin
  cflags: -O2 -g
  cxxflags: -O2 -g
  env:
    NPM_CONFIG_LOGLEVEL: info
modules:
  - name: boxy-svg
    buildsystem: simple
    build-options:
      env:
        XDG_CACHE_HOME: /run/build/boxy-svg/flatpak-node/cache
        npm_config_cache: /run/build/boxy-svg/flatpak-node/npm-cache
        npm_config_nodedir: /usr/lib/sdk/node14
        npm_config_offline: "true"
    subdir: main
    sources:
      - type: archive
        url: https://firebasestorage.googleapis.com/v0/b/boxy-svg.appspot.com/o/linux%2Fapp-3.81.0.zip?alt=media
        sha256: 21f608308595cfbd033205256f54f32752a267616e3749d7cf633b7daabd414d
        dest: main
      - generated-sources.json
      - type: script
        dest-filename: boxy-svg.sh
        commands:
          - zypak-wrapper.sh /app/main/boxy-svg "$@"
      - type: file
        path: com.boxy_svg.BoxySVG.appdata.xml
        dest: main
      - type: file
        path: com.boxy_svg.BoxySVG.desktop
        dest: main
      - type: file
        path: icons/16x16.png
        dest: main/icons
      - type: file
        path: icons/22x22.png
        dest: main/icons
      - type: file
        path: icons/24x24.png
        dest: main/icons
      - type: file
        path: icons/32x32.png
        dest: main/icons
      - type: file
        path: icons/48x48.png
        dest: main/icons
      - type: file
        path: icons/64x64.png
        dest: main/icons
      - type: file
        path: icons/96x96.png
        dest: main/icons
      - type: file
        path: icons/128x128.png
        dest: main/icons
      - type: file
        path: icons/256x256.png
        dest: main/icons
      - type: file
        path: icons/512x512.png
        dest: main/icons
      - type: file
        path: icons/scalable.svg
        dest: main/icons
    build-commands:
      # Install NPM dependencies
      - npm install --offline
      - npm install --offline --prefix ./src
      # Build the app
      - |
        . ../flatpak-node/electron-builder-arch-args.sh
        npm run dist -- $ELECTRON_BUILDER_ARCH_ARGS  --linux --dir
      # Bundle app and dependencies
      - cp -a dist/linux*unpacked /app/main
      # Install app wrapper
      - install ../boxy-svg.sh ${FLATPAK_DEST}/bin/boxy-svg
      # Install metadata files
      - install -Dm644 com.boxy_svg.BoxySVG.appdata.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
      - install -Dm644 com.boxy_svg.BoxySVG.desktop     $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
      - install -Dm644 icons/16x16.png                  $FLATPAK_DEST/share/icons/hicolor/16x16/apps/$FLATPAK_ID.png
      - install -Dm644 icons/22x22.png                  $FLATPAK_DEST/share/icons/hicolor/22x22/apps/$FLATPAK_ID.png
      - install -Dm644 icons/24x24.png                  $FLATPAK_DEST/share/icons/hicolor/24x24/apps/$FLATPAK_ID.png
      - install -Dm644 icons/32x32.png                  $FLATPAK_DEST/share/icons/hicolor/32x32/apps/$FLATPAK_ID.png
      - install -Dm644 icons/48x48.png                  $FLATPAK_DEST/share/icons/hicolor/48x48/apps/$FLATPAK_ID.png
      - install -Dm644 icons/64x64.png                  $FLATPAK_DEST/share/icons/hicolor/64x64/apps/$FLATPAK_ID.png
      - install -Dm644 icons/96x96.png                  $FLATPAK_DEST/share/icons/hicolor/96x96/apps/$FLATPAK_ID.png
      - install -Dm644 icons/128x128.png                $FLATPAK_DEST/share/icons/hicolor/128x128/apps/$FLATPAK_ID.png
      - install -Dm644 icons/256x256.png                $FLATPAK_DEST/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
      - install -Dm644 icons/512x512.png                $FLATPAK_DEST/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png
      - install -Dm644 icons/scalable.svg               $FLATPAK_DEST/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg